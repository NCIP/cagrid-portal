<!-- ======================================================================= -->
<!-- caGrid Utilities build file                                             -->
<!-- ======================================================================= -->
<project name="caGrid_test_utilities" basedir="." default="usage">
    
    <target name="usage">
        <echo message="Not to be called directly.  This file contains utilities to be used in other build files." />
    </target>

    <!-- =================================================================== -->
    <!-- Create a Dependancy Report (requires jdepend.jar in ant/lib         -->
    <!-- =================================================================== -->
    <target name="jdepend"
            if="jdepend.available"
            description="Create a dependancy report (requires jdepend.jar in ant/lib)">
        <jdepend format="xml" outputfile="${doc.dir}/jdepend-report.xml">
            <classespath>
                <pathelement location="${classes.dir}" />
            </classespath>
        </jdepend>
        <style basedir="docs"
               destdir="docs"
               includes="jdepend-report.xml"
               style="${ant.home}/etc/jdepend.xsl" />
    </target>


    <!-- =================================================================== -->
    <!-- Generates all the system files based off templates for a particular platform     -->
    <!-- =================================================================== -->
    <macrodef name="configure-scripts">
        <attribute name="scriptdir" />
        <attribute name="scriptsuffix" />
        <sequential>
            <copy todir="@{scriptdir}" filtering="true" overwrite="true">
                <fileset dir="@{scriptdir}">
                    <include name="*.script" />
                </fileset>
                <mapper type="glob" from="*.script" to="*.@{scriptsuffix}" />
            </copy>
            <chmod perm="ug+x">
                <fileset dir="@{scriptdir}">
                    <include name="*.@{scriptsuffix}" />
                </fileset>
            </chmod>
        </sequential>
    </macrodef>
	
    <macrodef name="configure-windows-scripts">
        <attribute name="scriptdir" />
        <attribute name="logdir" default="${log.dir}" />
        <attribute name="libdir" default="${lib.dir}" />
        <attribute name="serverclasspath" />
        <attribute name="clientclasspath" />
        <attribute name="relativeroot" default="${basedir}" />
        <attribute name="pathreplacement" default="..${file.separator}.." />
        <sequential>
            <load-filters attributemarker="%"
                          fileseparator="\"
                          os="windows"
                          pathseparator=";"
                          scriptsuffix="bat"
                          logdir="@{logdir}"
                          libdir="@{libdir}"
                          serverclasspath="@{serverclasspath}"
                          clientclasspath="@{clientclasspath}"
                          relativeroot="@{relativeroot}"
                          pathreplacement="@{pathreplacement}" />
            <configure-scripts scriptdir="@{scriptdir}" scriptsuffix="bat" />
        </sequential>
    </macrodef>
	
    <macrodef name="configure-unix-scripts">
        <attribute name="scriptdir" />
        <attribute name="logdir" default="${log.dir}" />
        <attribute name="libdir" default="${lib.dir}" />
        <attribute name="serverclasspath" />
        <attribute name="clientclasspath" />
        <attribute name="relativeroot" default="${basedir}" />
        <attribute name="pathreplacement" default="..${file.separator}.." />
        <sequential>
            <load-filters attributemarker="$"
                          fileseparator="/"
                          os="unix"
                          pathseparator=":"
                          scriptsuffix="sh"
                          logdir="@{logdir}"
                          libdir="@{libdir}"
                          serverclasspath="@{serverclasspath}"
                          clientclasspath="@{clientclasspath}"
                          relativeroot="@{relativeroot}"
                          pathreplacement="@{pathreplacement}" />
            <configure-scripts scriptdir="@{scriptdir}" scriptsuffix="sh" />
        </sequential>
    </macrodef>

    <macrodef name="configure-platform-scripts">
        <attribute name="scriptdir" />
        <attribute name="logdir" default="${log.dir}" />
        <attribute name="libdir" default="${lib.dir}" />
        <attribute name="serverclasspath" />
        <attribute name="clientclasspath" />
        <attribute name="relativeroot" default="${basedir}" />
        <attribute name="pathreplacement" default="..${file.separator}.." />
        <sequential>
            <configure-windows-scripts scriptdir="@{scriptdir}"
                                       logdir="@{logdir}"
                                       libdir="@{libdir}"
                                       serverclasspath="@{serverclasspath}"
                                       clientclasspath="@{clientclasspath}"
                                       relativeroot="@{relativeroot}"
                                       pathreplacement="@{pathreplacement}" />
            <configure-unix-scripts scriptdir="@{scriptdir}"
                                    logdir="@{logdir}"
                                    libdir="@{libdir}"
                                    serverclasspath="@{serverclasspath}"
                                    clientclasspath="@{clientclasspath}"
                                    relativeroot="@{relativeroot}"
                                    pathreplacement="@{pathreplacement}" />
        </sequential>
    </macrodef>


    <target name="check_build_properties">
        <condition property="build.props.present">
            <available file="${basedir}/build.properties" />
        </condition>
    </target>
	

	
</project>