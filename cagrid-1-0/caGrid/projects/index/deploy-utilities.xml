<?xml version="1.0"?>
<project name="deploy-utilities file" basedir="." default="deployTomcat">
	<property environment="env" />
	
	<!-- Tomcat Properties -->
	<property name="tomcat.dir" value="${env.CATALINA_HOME}" />
	<property name="tomcat.common.lib.dir" value="${tomcat.dir}/common/lib" />
	
	<property name="tomcat.deploy.dir" value="${tomcat.dir}/webapps/wsrf/WEB-INF" />
	<property name="tomcat.deploy.lib.dir" value="${tomcat.deploy.dir}/lib" />
	<property name="tomcat.deploy.etc.dir" value="${tomcat.deploy.dir}/etc" />
	
	<property name="tomcat.wsrf.schema.dir" value="${tomcat.dir}/webapps/wsrf/share/schema" />


	<!-- deploy  a gar to tomcat -->
	<target name="deployTomcat" description="Deploys to CATALINA_HOME">
		<echo message="Deploying service under Tomcat at ${tomcat.dir}" />
		
		<mkdir dir="tmp" />
		<!-- Make these to simplfy logic if they don't exist in the gars-->
		<mkdir dir="tmp/etc" />
		<mkdir dir="tmp/lib" />
		<mkdir dir="tmp/schema" />
		
		<unjar src="${gar.name}.gar" dest="tmp"/>
		<move file="tmp/server-deploy.wsdd" tofile="tmp/server-config.wsdd"/>
		
		<mkdir dir="${tomcat.deploy.etc.dir}/${gar.name}" />
		<!-- Copy config files to tomcat -->
		<copy includeemptydirs="false" overwrite="true" toDir="${tomcat.deploy.etc.dir}/${gar.name}">
			<fileset dir="tmp">
				<include name="*" />
			</fileset>
		</copy>
		<!-- Copy skeleton files to Tomcat and rename -->
		<copy overwrite="true" toDir="${tomcat.deploy.etc.dir}/${gar.name}">
			<fileset dir="tmp/etc">
				<include name="*" />
			</fileset>
		</copy>
			
		<!--copy over the jars to the lib -->
		<copy overwrite="true" toDir="${tomcat.deploy.lib.dir}">
			<fileset dir="tmp/lib">
				<include name="*" />
			</fileset>
		</copy>
		
		<!--copy over the schema service files-->
		<copy overwrite="true" toDir="${tomcat.wsrf.schema.dir}">
			<fileset dir="tmp/schema">
				<include name="**/*" />
			</fileset>
		</copy>
		
		<delete dir="tmp" />
	</target>
</project>
