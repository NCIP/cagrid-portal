<project name="deploy-gts" default="deploy-gts-service">

	<import file="common.xml"/>

	<target name="deploy-gts-service">
	
		<antcall target="configure-gts-conf" />

		<antcall target="deploy-service">
			<param name="deploy.service.name" value="gts" />
		</antcall>

		<antcall target="generate-gts-service-cert" />

		<scp file="${certs.dir}/${host}.cert"
			remoteToFile="${username}:${password}@${host}:${catalina.home}/${tomcat.cert.path}" />
		<scp file="${certs.dir}/${host}.key"
			remoteToFile="${username}:${password}@${host}:${catalina.home}/${tomcat.key.path}" />

	</target>


	<target name="configure-gts-conf">
		<property name="config.file"
			value="${cagrid.home}/projects/gts/etc/gts-conf.xml" />
		<xmltask source="${config.file}" dest="${config.file}">
			<replace path="/gts/resource/gts-config/gts-internal-id">
				<![CDATA[
					<gts-internal-id>${db.name}</gts-internal-id>
				]]>

			</replace>
			<replace path="/gts/resource/gts-config/database/host">
				<![CDATA[
					<host>${db.host}</host>
				]]>

			</replace>
			<replace path="/gts/resource/gts-config/database/port">
				<![CDATA[
					<port>${db.port}</port>
				]]>

			</replace>
			<replace
				path="/gts/resource/gts-config/database/username">
				<![CDATA[
					<username>${db.username}</username>
				]]>

			</replace>
			<replace
				path="/gts/resource/gts-config/database/password">
				<![CDATA[
					<password>${db.password}</password>
				]]>

			</replace>
		</xmltask>
	</target>

</project>