<project name="deploy-gridgrouper" default="deploy-gridgrouper-service">

	<import file="common.xml"/>

	<target name="deploy-gridgrouper-service">
		<antcall target="configure-grouper-hibernate-properties" />

		<antcall target="deploy-service">
			<param name="deploy.service.name" value="gridgrouper" />
		</antcall>

		<sshexec host="${host}" username="${username}"
			password="${password}"
			command="rm -f ${catalina.home}/common/lib/commons-collections*.jar" />
		<sshexec host="${host}" username="${username}"
			password="${password}"
			command="mv ${catalina.home}/webapps/wsrf/WEB-INF/lib/commons-collections-3.2.jar ${catalina.home}/common/lib/" />
		<sshexec host="${host}" username="${username}"
			password="${password}"
			command="rm -f ${catalina.home}/webapps/wsrf/WEB-INF/lib/commons-collections*.jar" />

	</target>



	<target name="configure-grouper-hibernate-properties">
		<propertyfile
			file="${cagrid.home}/projects/gridgrouper/resources/conf/grouper.hibernate.properties">
			<entry key="hibernate.connection.url"
				value="jdbc:mysql://${db.host}:${db.port}/grouper" />
			<entry key="hibernate.connection.username"
				value="${db.username}" />
			<entry key="hibernate.connection.password"
				value="${db.password}" />
		</propertyfile>
	</target>
</project>