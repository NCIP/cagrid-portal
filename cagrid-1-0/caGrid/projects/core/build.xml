<?xml version="1.0"?>
<!-- ================================================================= -->
<!-- caGrid 1.0 core build file                                        -->
<!-- ================================================================= -->

<project name="core" default="compile" basedir=".">
    <!-- Environment -->
    <property environment="env" />
    <property file="${basedir}/build.properties" />
    <property file="${user.dir}/build.properties" />
    <property name="globus.dir" location="${env.GLOBUS_LOCATION}" />

    <!-- Information -->
    <property name="project.name" value="caGrid-metadata" />
    <property name="project.version" value="1.0" />

    <property name="src.dir" value="${basedir}/src" />
    <property name="build.dir" value="${basedir}/build" />
    <property name="classes.dir" value="${build.dir}/classes" />
    <property name="jar.dir" value="${build.dir}/jars" />
    <property name="project.jarfile" value="${jar.dir}/${project.name}-${project.version}.jar" />
    <property name="lib.dir" value="${basedir}/lib" />
    
    <!-- testing stuff -->
    <property name="test.dir" location="${basedir}/test" />
    <property name="test.src.dir" location="${test.dir}/src/java" />
    <property name="test.classes.dir" location="${classes.dir}/test" />
    <property name="test.lib.dir" location="${test.dir}/lib" />
    <property name="test.project.jar" location="${jars.dir}/${project.name}-tests-${project.version}.jar" />
    
    <!-- Load common util path -->
    <import file="../../antfiles/ant-utilities.xml" />
    <import file="../../antfiles/test-utilities.xml" />


    <!-- =============================================================== -->
    <!-- The Classpath                                                   -->
    <!-- =============================================================== -->
    <path id="build.classpath">
        <fileset dir="${lib.dir}">
            <include name="**/*.jar" />
        </fileset>
    </path>


    <!-- =============================================================== -->
    <!-- Prepares the build directory                                    -->
    <!-- =============================================================== -->
    <target name="prepare" depends="configure">
        <tstamp />
        <mkdir dir="${build.dir}" />
    </target>


    <!-- =============================================================== -->
    <!-- Compiles the source code                                        -->
    <!-- =============================================================== -->
    <target name="compile" depends="prepare" description="compiles.">
        <mkdir dir="${classes.dir}" />
        <javac srcdir="${src.dir}" destdir="${classes.dir}" source="1.3" target="1.1" debug="on" deprecation="off" optimize="off">
            <classpath refid="build.classpath" />
        </javac>
    </target>
    
    <!-- =============================================================== -->
    <!-- Compiles the test source code                                        -->
    <!-- =============================================================== -->
    <target name="compile-tests" depends="prepare" description="compiles.">
        <mkdir dir="${test.classes.dir}" />
        <javac srcdir="${test.src.dir}" destdir="${test.classes.dir}" source="1.3" target="1.1" debug="on" deprecation="off" optimize="off">
            <classpath refid="build.classpath" />
        </javac>
    </target>


    <!-- ============================================================== -->
    <!-- Cleans up generated stuff                                      -->
    <!-- ============================================================== -->
    <target name="clean" depends="" description="Removes generated files.">
        <delete dir="${build.dir}" />
    </target>


    <!-- ============================================================== -->
    <!-- Creates the test jar files                                          -->
    <!-- ============================================================== -->
    <target name="jar" depends="compile" description="Builds the Jar Files">
        <mkdir dir="${jar.dir}" />
        <jar jarfile="${project.jarfile}" basedir="${classes.dir}">
            <manifest>
                <attribute name="Built-By" value="${user.name}" />
                <attribute name="Main-Class" value="${main.class}" />
            </manifest>
        </jar>
    </target>
    
    <!-- ============================================================== -->
    <!-- Creates the jar files                                          -->
    <!-- ============================================================== -->
    <target name="jarTests" depends="compile" description="Builds the Jar Files">
        <mkdir dir="${jar.dir}" />
        <jar jarfile="${test.project.jar}" basedir="${test.classes.dir}">
            <manifest>
                <attribute name="Built-By" value="${user.name}" />
            </manifest>
        </jar>
    </target>
    
    <target name="build-my-filters" depends="platformCheck">
        <property name="my.classpath" refid="build.classpath" />
        <filter token="classpath" value="${my.classpath}" />
        <filter token="file.separator" value="${file.separator}" />
        <filter token="base.dir" value="${basedir}" />
        <filter token="test.dir" value="${test.dir}" />
        <filter token="src.dir" value="${src.dir}" />
        <filter token="lib.dir" value="${lib.dir}" />
        <filter token="log.dir" value="${log.dir}" />
        <filter token="scripts.dir" value="${scripts.dir}" />
        <filter token="build.dir" value="${build.dir}" />
        <filter token="classes.dir" value="${classes.dir}" />
        <filter token="doc.dir" value="${doc.dir}" />
        <filter token="logger.arg" value="-Djava.util.logging.config.file=${basedir}${file.separator}logging.properties" />
        <filter token="attributeMarker" value="${attributeMarker}" />
        <filter token="platformScriptSuffix" value="${platformScriptSuffix}" />
        <filter token="pause.command" value="${pause.command}" />
    </target>
    
    
    <target name="configure" depends="platformCheck,build-common-filters,build-my-filters,configure-dart-templates" description="Generates all the system files based off templates">
    </target>
    


    <!-- ============================================================== -->
    <!-- Builds from scratch                                                -->
    <!-- ============================================================== -->
    <target name="all" description="Builds the entire application" depends="clean,jar,jarTests" />
</project>

