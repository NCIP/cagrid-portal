<project name="caGrid-websso" default="all">

	<property environment="env" />
	<property file="${basedir}/project.properties" />
	<property file="${basedir}/build.properties" />
	
	<property name="ext.dir" location="ext" />

    <property name="lib.dir" location="lib" />
	<property name="ext.lib.dir" location="${ext.dir}/dependencies/default/jars" />
	<property name="endorsed.lib.dir" location="${ext.dir}/dependencies/endorsed/jars" />

    <property name="webapp.name" value="cas" />
    <property name="webcontent.dir" location="webcontent" />

    <property name="src.java.dir" location="src/java" />
    <property name="src.resources.dir" location="src/resources" />

    <property name="build.dir" location="build" />
    <property name="build.classes.dir" location="${build.dir}/classes" />
    <property name="build.lib.dir" location="${build.dir}/lib" />
	<property name="build.war.dir" location="${build.dir}/war" />


    <path id="build.classpath">
        <fileset dir="${lib.dir}">
            <include name="**/*.jar" />
        </fileset>
        <fileset dir="${ext.lib.dir}">
            <include name="*.jar" />
        </fileset>
        <fileset dir="${env.GLOBUS_LOCATION}/lib">
            <include name="**/*.jar" />
        </fileset>
    </path>

    <target name="build-war">
    	<jar destfile="${build.war.dir}/WEB-INF/lib/${ant.project.name}-conf-${project.version}.jar" basedir="${src.resources.dir}" />
        <copy todir="${build.war.dir}/WEB-INF/lib"  overwrite="true">
            <!-- TODO: make these includes only include what is necessary... and handle version conflicts -->
            <fileset dir="${lib.dir}">
                <include name="*.jar" />
            </fileset>
            <fileset dir="${env.GLOBUS_LOCATION}/lib">
            	<include name="axis.jar"/>
            	<include name="wsrf_core_stubs.jar"/>
            	<include name="jaxrpc.jar"/>
            	<include name="addressing-1.0.jar"/>
            	<include name="cog-axis.jar"/>
            	<include name="saaj.jar"/>
            	<include name="commons-discovery.jar"/>
            	<include name="wsdl4j.jar"/>
            	<include name="wsrf_core.jar"/>
            	<include name="puretls.jar"/>
            	<include name="cryptix.jar"/>
            	<include name="cryptix32.jar"/>
            	<include name="cryptix-asn1.jar"/>
            	<include name="wss4j.jar"/>
            	<include name="xalan.jar"/>
            	<include name="jce-jdk13-125.jar"/>
            </fileset>
            <fileset dir="${ext.lib.dir}">
                <include name="*.jar" />
            </fileset>
        	<fileset dir="${endorsed.lib.dir}">
        	     <include name="*.jar" />
            </fileset>
        </copy>
    </target>

    <target name="compile">
        <mkdir dir="${build.classes.dir}" />
        <javac srcdir="${src.java.dir}" destdir="${build.classes.dir}" classpathref="build.classpath" debug="true" />
        <mkdir dir="${build.war.dir}/WEB-INF/lib" />
    	<jar destfile="${build.war.dir}/WEB-INF/lib/${ant.project.name}-core-${project.version}.jar" basedir="${build.classes.dir}" />
    </target>

    <target name="war" depends="compile,build-war">
        <war destfile="${build.dir}/${webapp.name}.war" webxml="${webcontent.dir}/WEB-INF/web.xml">
            <fileset dir="${webcontent.dir}" />
            <lib dir="${build.war.dir}/WEB-INF/lib" />
        </war>
    </target>

    <target name="clean">
        <delete dir="${build.dir}" />
    </target>

    <target name="all">
    	<echo>*********************************************</echo>
    	<echo>#     #                #####   #####  #######</echo>
    	<echo>#  #  # ###### #####  #     # #     # #     #</echo>
    	<echo>#  #  # #      #    # #       #       #     #</echo>
    	<echo>#  #  # #####  #####   #####   #####  #     #</echo>
    	<echo>#  #  # #      #    #       #       # #     #</echo>
    	<echo>#  #  # #      #    # #     # #     # #     #</echo>
    	<echo> ## ##  ###### #####   #####   #####  #######</echo>
    	<echo>*********************************************</echo>
        <antcall target="clean" />
        <antcall target="war" />
    </target>
</project>
