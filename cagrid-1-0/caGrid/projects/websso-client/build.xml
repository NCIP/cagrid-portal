<project name="websso" default="all">

    <property environment="env" />

    <property file="build.properties" />
    <property name="ext.dir" location="ext" />
    <property file="${ext.dir}/resources/cagrid.properties" />

    <property name="lib.dir" location="lib" />
    <property name="ext.lib.dir" location="${ext.dir}/lib" />
	<property name="endorsed.lib.dir" location="${ext.dir}/endorsed/lib" />

    <property name="jar.name" value="websso-cas-client.jar" />

    <property name="src.java.dir" location="src/java" />

    <property name="build.dir" location="build" />
    <property name="build.classes.dir" location="build/classes" />


    <path id="build.classpath">
        <fileset dir="${lib.dir}">
            <include name="**/*.jar" />
        </fileset>
        <fileset dir="${ext.lib.dir}">
            <include name="*.jar" />
        </fileset>
        <fileset dir="${env.GLOBUS_LOCATION}/lib">
            <include name="**/*.jar" />
        </fileset>
    </path>

    <target name="dist">
        <copy todir="${build.dir}" flatten="true" overwrite="true">
            <!-- TODO: make these includes only include what is necessary... and handle version conflicts -->
            <fileset dir="${lib.dir}">
                <include name="*.jar" />
            </fileset>
            <fileset dir="${ext.lib.dir}">
                <include name="*.jar" />
            </fileset>
        	<fileset dir="${endorsed.lib.dir}">
                <include name="*.jar" />
            </fileset>
            <fileset dir="${env.GLOBUS_LOCATION}/lib">
            	<include name="axis.jar"/>
            	<include name="cog-jglobus.jar"/>
            	<include name="wsrf_core_stubs.jar"/>
            	<include name="jaxrpc.jar"/>
            	<include name="addressing-1.0.jar"/>
            	<include name="cog-axis.jar"/>
            	<include name="saaj.jar"/>
            	<include name="commons-discovery.jar"/>
            	<include name="wsdl4j.jar"/>
            	<include name="wsrf_core.jar"/>
            	<include name="puretls.jar"/>
            	<include name="cryptix.jar"/>
            	<include name="cryptix32.jar"/>
            	<include name="cryptix-asn1.jar"/>
            	<include name="wss4j.jar"/>
            	<include name="xalan.jar"/>
            	<include name="jce-jdk13-125.jar"/>
            </fileset>
        </copy>
    </target>

    <target name="build-jar">
		<jar jarfile="${build.dir}/${jar.name}" basedir="${build.classes.dir}" includes="**/*.class"/>
    	<delete dir="${build.classes.dir}"/>
    </target>


    <target name="compile">
        <mkdir dir="${build.dir}" />
        <mkdir dir="${build.classes.dir}" />    	
        <javac srcdir="${src.java.dir}" destdir="${build.classes.dir}" classpathref="build.classpath" debug="true" />
    </target>

    <target name="jar" depends="compile,build-jar,dist">
    </target>

    <target name="clean">
        <delete dir="${build.dir}" />
    </target>

    <target name="all">
        <antcall target="clean" />
        <antcall target="jar" />
    </target>
</project>