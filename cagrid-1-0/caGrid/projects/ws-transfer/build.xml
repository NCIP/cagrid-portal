<?xml version="1.0"?>

<project default="deploy" name="globus_delegation_service" basedir=".">

    <property environment="env"/>
    <property name="env.GLOBUS_LOCATION" value="../../../../../install"/>
    <property name="deploy.dir" location="${env.GLOBUS_LOCATION}"/>
    <property name="abs.deploy.dir" location="${deploy.dir}"/>

    <property name="schema.build" location="common/schema"/>
    <property name="stubs.build" location="common/java/source"/>
    <property name="service.build" location="service/java/source"/>
    <property name="service.test.build" location="service/java/test"/>

    <target name="deploy">
        <ant dir="${schema.build}" target="deploy"/>
        <ant dir="${stubs.build}" target="deploy"/>
        <ant dir="${service.build}" target="deploy"/>
        <ant dir="${service.test.build}" target="deploy"/>
    </target>

    <target name="deployAll" depends="deploy">
        <ant dir="${service.test.build}" target="deployInt"/>
    </target>

    <target name="undeploy">
        <ant dir="${schema.build}" target="undeploy"/>
        <ant dir="${stubs.build}" target="undeploy"/>
        <ant dir="${service.build}" target="undeploy"/>
        <ant dir="${service.test.build}" target="undeploy"/>
    </target>

    <target name="clean">
        <ant dir="${schema.build}" target="clean"/>
        <ant dir="${stubs.build}" target="clean"/>
        <ant dir="${service.build}" target="clean"/>
        <ant dir="${service.test.build}" target="clean"/>
        <delete file="pmd_report.html" failonerror="false"/>
        <delete dir="javadocs" failonerror="false"/>
    </target>

 <target name="javadocs" depends="deploy">
    <property name="name" value="Globus Toolkit WS Transfer Service "/>
    <property name="globus.copyright" value="Copyright &#169; 1999-2003 University of Chicago and The University of Southern California.  All rights reserved."/>  
    <property name="javadocs.dir" value="javadocs"/>
    <delete dir="$javadocs.dir}"/>
    <mkdir dir="${javadocs.dir}"/>
    <javadoc destdir="${javadocs.dir}"
             author="true"
             version="true"
             use="true"
             windowtitle="${name} ${version} API"
             doctitle="${name} ${version}"
             bottom="${globus.copyright}">
      <classpath>
        <fileset dir="${deploy.dir}/lib">
          <include name="*.jar"/>
        </fileset>
      </classpath>
      <link href="http://java.sun.com/j2se/1.3/docs/api/" />
      <link href="http://java.sun.com/j2se/1.4.2/docs/api/"/>
      <link href="http://ws.apache.org/axis/java/apiDocs/"/>
      <link href="http://ws.apache.org/ws-fx/addressing/apidocs/"/>
      <link href="http://www-unix.mcs.anl.gov/~gawor/jglobus-nightly/HEAD/javadoc/"/>
      <packageset dir="${stubs.build}/build/stubs/src" defaultexcludes="yes"/>
      <packageset dir="${service.build}/src" defaultexcludes="yes"/>
    </javadoc>
 </target>


 <target name="pmd">
   <property name="pmd.rules" 
             value="rulesets/imports.xml,rulesets/unusedcode.xml,rulesets/imports.xml,rulesets/basic.xml"/>
   <taskdef name="pmd" classname="net.sourceforge.pmd.ant.PMDTask"/>
   <pmd rulesetfiles="${pmd.rules}" shortFilenames="true">
      <formatter type="html" toFile="pmd_report.html"/>
      <fileset dir="common">
            <include name="**/*.java"/>
            <exclude name="**/stubs/**/*.java"/>
      </fileset>
      <fileset dir="service">
            <include name="**/*.java"/>
      </fileset>
   </pmd>
 </target>

 <target name="findbugs">
    <taskdef name="findbugs" 
             classname="edu.umd.cs.findbugs.anttask.FindBugsTask"/>
    <findbugs home="${env.FINDBUGS_HOME}" output="html"
              outputFile="findbugs_report.html" jvmargs="-Xmx1024m"  >
      <auxClasspath>
         <fileset dir="${deploy.dir}/lib">
              <include name="*.jar" />
         </fileset>
      </auxClasspath>
      <class location="${deploy.dir}/lib/globus_delegation_client.jar" />
      <class location="${deploy.dir}/lib/globus_delegation_service.jar" />
      <class location="${deploy.dir}/lib/globus_delegation_test.jar" />
    </findbugs>
  </target>

</project>