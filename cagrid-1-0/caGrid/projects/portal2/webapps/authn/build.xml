<project name="authn" default="all">

	<property file="build.properties" />
	<property environment="env" />
	<property file="../../ext/resources/cagrid.properties"/>
	<import file="../../ant-files/common.xml" />

	<patternset id="compile.jars">
		<include name="spring/*.jar" />
		<include name="log4j/*.jar" />
		<include name="j2ee/jstl.jar" />
		<include name="jakarta-commons/*.jar" />
		<include name="jakarta-taglib/standard.jar" />
		<include name="hibernate/**/*.jar" />
		<include name="aspectj/*.jar" />
		<exclude name="**/ant-*.jar" />
	</patternset>

	<path id="run.cp">
		<fileset dir="../../lib">
			<patternset refid="compile.jars" />
		</fileset>
		<fileset dir="../../common/build">
			<include name="${cagrid.master.jar.prefix}portal2-common.jar" />
		</fileset>
		<fileset dir="../../ext/lib">
			<patternset refid="ext.jars" />
			<patternset refid="crypto.jars" />
		</fileset>
		<fileset dir="../../services/webauthn/build/lib">
			<include name="${cagrid.master.jar.prefix}WebAuthnSvc-client.jar" />
			<include name="${cagrid.master.jar.prefix}WebAuthnSvc-common.jar" />
			<include name="${cagrid.master.jar.prefix}WebAuthnSvc-stubs.jar" />
		</fileset>
		<fileset dir="${env.GLOBUS_LOCATION}/lib">
			<patternset refid="globus.jars" />
			<patternset refid="crypto.jars" />
		</fileset>
	</path>
	<path id="compile.cp">
		<path refid="run.cp" />
		<pathelement location="../../lib/portlet/portlet.jar" />
		<pathelement location="../../lib/servlet/servlet-api.jar" />
	</path>

	<target name="build-war">
		<mkdir dir="${build.war.dir}/WEB-INF/lib" />
		<copy todir="${build.war.dir}/WEB-INF/lib" flatten="true"
			overwrite="true">
			<fileset dir="../../lib">
				<patternset refid="compile.jars" />
			</fileset>
			<fileset dir="../../common/build">
				<include name="${cagrid.master.jar.prefix}portal2-common.jar" />
			</fileset>

			<fileset dir="../../ext/lib">
				<patternset refid="ext.jars" />
			</fileset>

			<fileset dir="../../services/webauthn/build/lib">
				<include name="${cagrid.master.jar.prefix}WebAuthnSvc-client.jar" />
				<include name="${cagrid.master.jar.prefix}WebAuthnSvc-common.jar" />
				<include name="${cagrid.master.jar.prefix}WebAuthnSvc-stubs.jar" />
			</fileset>

			<fileset dir="${env.GLOBUS_LOCATION}/lib">
				<patternset refid="globus.jars" />
				<patternset refid="crypto.jars" />
			</fileset>

		</copy>
	</target>

	<target name="compile">
		<mkdir dir="${build.classes.dir}" />
		<javac srcdir="${src.java.dir}" destdir="${build.classes.dir}"
			classpathref="compile.cp" />
	</target>

	<target name="war" depends="compile,build-war">
		<war destfile="${build.dir}/${webapp.name}.war"
			webxml="${src.war.dir}/WEB-INF/web.xml">
			<fileset dir="${src.war.dir}" />
			<classes dir="${build.classes.dir}" />
			<lib dir="${build.war.dir}/WEB-INF/lib" />
		</war>
	</target>

	<target name="clean">
		<delete dir="${build.dir}" />
	</target>

	<target name="all">
		<antcall target="clean" />
		<antcall target="war" />
	</target>

</project>