This will get simpler in the future. For now, there are lots of 
manual steps.

Install MySQL.

Configure portal common
 - modify portal2/common/db/default.properties
   - set connection parameters correctly
 - run: ant gen-ddl -Ddrop.tables=false
 - run: ant jar

Create portal2 database (this holds cagrid portal data)

     create database portal2;
     grant all privileges on portal2.* to 'portal2'@'%' identified by 'portal2';

Import portal2 schema:

	mysql -u root -p portal2 < portal2/common/gen/portal.ddl
	
Create cagridportal database (this holds jetspeed-specific data)

	 create database cagridportal;
     grant all privileges on cagridportal.* to 'cagridportal'@'%' identified by 'cagridportal';

Populate database:     
 - in portal2/common, run: ant test

Use the caGrid installer to install a non-secure, tomcat container
 - shutdown port 8007
 - http port 8082
 - manually remove AJP/1.3 connector
 - grant execute permission on scripts in bin directory
 
Install apache tomcat 5.5.23
 - shutdown port 8008
 - http port 8083
 - manually remove AJP/1.3 connector
 - grant execute permission on scripts in bin directory 

Install the WebAuthnSvc grid service
 - from portal2/services/webauthn, 
   - type: and deployTomcat -Dtomcat.dir=<path_to_tomcat_5.0.28>
   - type: runClient -Dservice.url=<service_url>
      - ensure that you see SAML printed to console
 
Install the authn webapp
 - Edit portal2/webapps/authn/src/war/WEB-INF/authn-servlet.xml
   - edit "idpUrls" bean to set appropriate URLs for IdP services
   - edit "webAuthnSvcClient" constructor arg to be URL of WebAuthnSvc
 - In portal2/webapps/authn, type: 
    - ant war
    - cp build/authn.war <apache-tomcat-5.5.23>/webapps/
     
Copy lib/mysql/mysql*.jar to apache-tomcat-5.5.23/common/lib directory.
Modify apache-tomcat-5.5.23/conf/tomcat-users.xml. It should look like this:

	<?xml version='1.0' encoding='utf-8'?>
	<tomcat-users>
	  <role rolename="tomcat"/>
	  <user username="tomcat" password="tomcat" roles="tomcat"/>
	  <user username="j2deployer" password="j2deployer" roles="manager"/>
	</tomcat-users>

If you are using Windows, modify CATALINA_HOME/conf/context.xml to look like this:

	<Context antiJARLocking="true">
    ...
    </Context>

Install Maven 1.0.2.
 - We use the Jetspeed custom Maven plugin to create the custom portal skeleton. So, we need
   to first install Maven. Instructions are here:
    - http://maven.apache.org/maven-1.x/start/download.html
    - http://maven.apache.org/maven-1.x/start/install.html

Install Jetspeed 2.1
 - Copy portal2/portals/maven.build.properties to HOME/build.properties
 - Modify the following properties to suit your environment:

     org.apache.jetspeed.portal.home: where the custom portal skeleton will be installed
     org.apache.jetspeed.server.home: where you installed Tomcat, i.e. CATALINA_HOME
     org.apache.jetspeed.production.database.url: JDBC url to the cagridportal database
     org.apache.jetspeed.production.jdbc.drivers.path: location of the MySQL driver jar
     
 - From anywhere, run:
 
 	maven -DartifactId=maven-jetspeed2-plugin -DgroupId=org.apache.portals.jetspeed-2 -Dversion=2.1 plugin:download
 	maven j2:portal.genapp
 	  - or j2:portal.genapp.minimal
 	
 - From ${org.apache.jetspeed.portal.home}, run:
 
 	maven war:install
 	mkdir logs
 	touch logs/apacheds.xml
 	maven j2:quickStart
 	  - or j2:minStart

Install caGrid customizations
 - From portal2/portals/jetspeed
   - Modify build.properties. Set the jetspeed.tomcat.dir appropriately for
     your environment.
   - Modify the "securityValve" bean in portal2/portals/jetspeed/ext/target/cagridportal/WEB-INF/assembly/pipelines.xml
      - set the loginApplicationUrl to http://cbiovdev5017.nci.nih.gov:8083/authn/authn/login
      - set the logoutApplicationUrl to http://cbiovdev5017.nci.nih.gov:8083/authn/authn/logout
      - set the ifsUrl to Dorian's https://cbiovdev5035.nci.nih.gov:8443/wsrf/services/cagrid/Dorian
      - set the webAuthnSvcUrl to http://cbiovdev5035.nci.nih.gov:8082/wsrf/services/cagrid/WebAuthnSvc
   - Run:
   		ant copy-pages
   		ant copy-decoration
   		and deploy-assembly

Start up apache-tomcat-5.5.23

Install porlets
 - From portal2/webapps/cagridportlets, run:
 
 		ant
 		cp build/cagridportlets.war <apache-tomcat-5.5.23>/webapps/cagridportal/WEB-INF/deploy/
 		
Go to http://<host>:<port>/cagridportal