<project name="jetspeed">

	<property file="../../ant-files/common.properties" />
	<property file="build.properties" />

	<import file="../../ant-files/common.xml" />

	<property environment="env" />





	<target name="copy-conf">
		<copy todir="${jetspeed.ext.dir}" overwrite="true">
			<fileset dir="ext">
				<include name="**/*" />
			</fileset>
		</copy>
	</target>

	<target name="copy-pages">
		<copy
			todir="${jetspeed.tomcat.dir}/webapps/${jetspeed.custom.portal.name}/WEB-INF/pages"
			overwrite="true">
			<fileset
				dir="ext/target/${jetspeed.custom.portal.name}/WEB-INF/pages">
				<include name="**/*" />
			</fileset>
		</copy>
	</target>

	<target name="copy-decoration">
		<copy
			todir="${jetspeed.tomcat.dir}/webapps/${jetspeed.custom.portal.name}/decorations"
			overwrite="true">
			<fileset
				dir="ext/target/${jetspeed.custom.portal.name}/decorations">
				<include name="**/*" />
			</fileset>
		</copy>
	</target>

	<target name="deploy-assembly" depends="jar">
		<copy
			todir="${jetspeed.tomcat.dir}/webapps/${jetspeed.custom.portal.name}/WEB-INF/assembly"
			overwrite="true">
			<fileset
				dir="ext/target/${jetspeed.custom.portal.name}/WEB-INF/assembly">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy
			todir="${jetspeed.tomcat.dir}/webapps/${jetspeed.custom.portal.name}/WEB-INF/conf"
			overwrite="true">
			<fileset
				dir="ext/target/${jetspeed.custom.portal.name}/WEB-INF/conf">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy
			todir="${jetspeed.tomcat.dir}/webapps/${jetspeed.custom.portal.name}/WEB-INF/lib"
			overwrite="true">
			<fileset dir="build">
				<include name="cagrid-portal2-jetspeed.jar" />
			</fileset>
			<fileset dir="../../ext/lib/">
				<patternset refid="ext.jars" />
			</fileset>
			<fileset dir="${env.GLOBUS_LOCATION}/lib">
				<patternset refid="globus.jars" />
			</fileset>
			<fileset dir="../../services/webauthn/build/lib">
				<include name="WebAuthnSvc-client.jar" />
				<include name="WebAuthnSvc-common.jar" />
				<include name="WebAuthnSvc-stubs.jar" />
			</fileset>
		</copy>
		<copy todir="${jetspeed.tomcat.dir}/common/lib"
			overwrite="true">
			<fileset dir="${env.GLOBUS_LOCATION}/lib">
				<patternset refid="crypto.jars" />
			</fileset>
			<fileset dir="../../ext/lib">
				<patternset refid="crypto.jars" />
			</fileset>
		</copy>

	</target>

	<target name="deploy-portlets">
		<for list="${portlets.list}" param="portletName"
			parallel="false">
			<sequential>
				<antcall target="deploy-portlet">
					<param name="portletName" value="@{portletName}" />
				</antcall>
			</sequential>
		</for>
	</target>

	<target name="deploy-portlet-apps">
		<copy
			file="../../webapps/${portletName}/build/${portletName}.war"
			todir="${jetspeed.autodeploy.dir}" />
	</target>

	<target name="compile">
		<mkdir dir="build/classes" />
		<javac srcdir="src/java" destdir="build/classes">
			<classpath>
				<fileset dir="../../lib">
					<include name="jakarta-commons/*.jar" />
					<include name="jetspeed/*.jar" />
					<include name="log4j/*.jar" />
					<include name="servlet/*.jar" />
				</fileset>
				<fileset dir="../../ext/lib/">
					<patternset refid="ext.jars" />
					<patternset refid="crypto.jars" />
				</fileset>
				<fileset dir="${env.GLOBUS_LOCATION}/lib">
					<patternset refid="globus.jars" />
					<patternset refid="crypto.jars" />
				</fileset>
				<fileset dir="../../services/webauthn/build/lib">
					<include name="WebAuthnSvc-client.jar" />
					<include name="WebAuthnSvc-common.jar" />
					<include name="WebAuthnSvc-stubs.jar" />
				</fileset>
			</classpath>
		</javac>
	</target>

	<target name="jar" depends="compile">
		<jar destfile="build/cagrid-portal2-jetspeed.jar">
			<fileset dir="build/classes" />
		</jar>
	</target>

	<target name="clean">
		<delete dir="build" />
	</target>

	<target name="all" depends="clean,jar" />
</project>