<?xml version="1.0"?>
<project name="developers-build-deploy file" basedir=".">
	<!-- ============================================================== -->
	<!-- This file is designed to allow the developer to extend the     -->
	<!-- deploy process without having to edit the build-deploy.xml     -->
	<!-- file. DO NOT REMOVE ANY TARGETS                                -->
	<!-- ============================================================== -->
	<available file="${tomcat.deploy.lib.dir}/cog-jglobus.jar" type="file" property="cog-jglobus.tomcat.deploy.present" />
	<available file="${tomcat.common.lib.dir}/cog-jglobus.jar" type="file" property="cog-jglobus.tomcat.common.present" />


	<!-- ============================================================== -->
	<!-- Pre Deploy Tomcat                                              -->
	<!-- ============================================================== -->
	<target name="preDeployTomcat" depends="deployTrustedCerts,deployPatchedCogToTomcat">
		<copy todir="${build.lib.dir}">
			<fileset dir="${ext.lib.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>
		<copy overwrite="true" toDir="tmp/etc">
			<fileset file="${sync.description.file}" />
		</copy>
	</target>


	<!-- Conditionally copy the patched cog to tomcat, only replacing it where its present, as it exists in different places for secure and insecure deployments  -->
	<target name="deployPatchedCogToTomcat" depends="deployPatchedCogToTomcatCommon,deployPatchedCogToTomcatLib" />
	<target name="deployPatchedCogToTomcatLib" if="cog-jglobus.tomcat.deploy.present">
		<echo message="Replacing cog-jglobus.jar in tomcat's service area: ${tomcat.deploy.lib.dir}" />
		<copy overwrite="true" toDir="${tomcat.deploy.lib.dir}">
			<fileset dir="${ext.patched.jars.dir}">
				<include name="cog-jglobus.jar" />
			</fileset>
		</copy>
	</target>
	<target name="deployPatchedCogToTomcatCommon" if="cog-jglobus.tomcat.common.present">
		<echo message="Replacing cog-jglobus.jar in tomcat's common area: ${tomcat.common.lib.dir}" />
		<copy overwrite="true" todir="${tomcat.common.lib.dir}">
			<fileset dir="${ext.patched.jars.dir}">
				<include name="cog-jglobus.jar" />
			</fileset>
		</copy>
	</target>



	<!-- ============================================================== -->
	<!-- Pre Deploy Globus                                              -->
	<!-- ============================================================== -->
	<target name="preDeployGlobus" depends="deployTrustedCerts">
		<copy todir="${build.lib.dir}">
			<fileset dir="${ext.lib.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>
		<copy overwrite="true" toDir="tmp/etc">
			<fileset file="${sync.description.file}" />
		</copy>
	</target>

</project>