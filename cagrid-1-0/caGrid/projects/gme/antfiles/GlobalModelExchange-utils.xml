<!-- ======================================================================= -->
<!-- caGRID GME Utilities build file                                  -->
<!-- ======================================================================= -->
<project name="globalModelExchange_utilities" basedir="." default="usage">
	<path id="GlobalModelExchange.classpath">
		<fileset dir="${build.lib.dir}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${ext.lib.dir}">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${globus.location}/lib">
			<include name="*.jar" />
            <exclude name="junit.jar"/>
			<exclude name="${stubs.jar.name}" />
			<exclude name="${jar.name}" />
		</fileset>
	</path>
	<target name="gmeViewer" description="Execute the Gme Viewer">
		<java classname="org.globus.bootstrap.Bootstrap" fork="yes">
			<jvmarg value="-DGLOBUS_LOCATION=${globus.location}" />
			<arg value="org.projectmobius.tools.gme.viewer.GMEView" />
			<arg value="-config" />
			<arg value="conf/gme-view-globus-config.xml" />
			<classpath>
				<path refid="GlobalModelExchange.classpath" />
			</classpath>
		</java>
	</target>
	<macrodef name="gmeExtractMacro">
		<attribute name="service" />
		<attribute name="uris" />
		<attribute name="directory" />
		<sequential>
			<java classname="org.projectmobius.tools.gme.GMESchemaImportsManager" fork="yes">
				<arg value="-service" />
				<arg value="@{service}" />
				<arg value="-uris" />
				<arg value="@{uris}" />
				<arg value="-directory" />
				<arg value="@{directory}" />
				<arg value="-factory" />
				<arg value="org.projectmobius.gme.client.GlobusGMEXMLDataModelServiceFactory" />
				<classpath>
					<path refid="GlobalModelExchange.classpath" />
				</classpath>
			</java>
		</sequential>
	</macrodef>
	<target name="gmeExtract" depends="promptDirectory,promptService,promptURIs" description="Extract types from GME for use in grid
		services.">
		<gmeExtractMacro directory="${gme.extract.directory}" service="${gme.service.url}" uris="${gme.schema.uris}" />
	</target>


	<target name="promptDirectory" unless="gme.extract.directory">
		<input message="Please enter the directory place the schema files. [./]:" addproperty="gme.extract.directory" defaultvalue="./" />
	</target>

	<target name="promptService" unless="gme.service.url">
		<input message="Please enter the service url of the GME. [http://localhost:8080/wsrf/services/cagrid/GlobalModelExchange]:" addproperty="gme.service.url" defaultvalue="http://localhost:8080/wsrf/services/cagrid/GlobalModelExchange" />
	</target>

	<target name="promptURIs" unless="gme.schema.uris">
		<input message="Please enter a comma separated list of schema uris to retrieve. :" addproperty="gme.schema.uris" defaultvalue="" />
	</target>
</project>
