<!-- ======================================================================= -->
<!-- caGRID Properties Utilities build file                                  -->
<!-- ======================================================================= -->
<project name="cagrid_properties_utilities" basedir="." default="usage">
	<property environment="env" />
	
	<condition property="tomcat.dir" value="${env.CATALINA_HOME}">
    	<or>
        	<not>
            <isset property="tomcat.dir" />
            </not>
            <equals arg1="${tomcat.dir}" arg2="" />
        </or>
	</condition>
    <property name="tomcat.lib" value="${tomcat.dir}/common/lib" />
    <property name="cagrid.schemadir" location="${basedir}/schema" />

    <property name="cagrid.gwsdldir" value="cagrid/gdsf" />
    <property name="cagrid.confdir" value="${basedir}/config" />
    <property name="interface.name" value="caGridDataServiceFactoryPortType" />

    <property name="tomcat.server.xml" value="/conf/server.xml" />
    <property name="tomcat.relative.path" value="/ogsa/services/" />
    <!-- XPath to port number in Tomcat 4.1.27 server configuration file -->
    <property name="tomcat.port.xpath" value="/Server/Service[1]/Connector[1]/@port" />
    <property name="tomcat.deploy.dir" value="${tomcat.dir}/webapps/ogsa/WEB-INF" />
    <property name="dai.user.dir" value="${basedir}" />
    <property name="dai.lib.dir" value="${dai.user.dir}/lib" />
    <property name="dai.conf.dir" value="${dai.user.dir}/examples/" />
    <property name="dai.skeletons.dir" value="${dai.user.dir}/config" />
    <property name="dai.adapter.dir" value="${dai.user.dir}/adapters" />

    <property name="cagrid.dai.registry" value="http://cbiogrid103.nci.nih.gov:8080/ogsa/services/ogsadai/DAISGR" />
    <property name="cagrid.vor.registry" value="http://cbiogrid103.nci.nih.gov:8080/ogsa/services/samples/registry/VORegistryService" />
	<property name="index.service.registry" value="http://cagrid-registry.nci.nih.gov/ogsa/services/cagrid/IndexService" />

    <property name="cagrid.mds.index" value="http://cagrid-registry.nci.nih.gov/ogsa/services/cagrid/IndexService" />

    <target name="prepare" depends="setTomcat, setProperties" />

    <target name="usage">
        <echo message="Not to be called directly.  This file contains utilities to be used in other build files." />
    </target>

    <!-- ============================================================== -->
    <!-- Set properties                                                 -->
    <!-- ============================================================== -->
    <target name="setProperties" depends="checkTomcat">
        <property name="ogsadai.dir" value="${tomcat.dir}/webapps/ogsa" />
        <property name="ogsadai.libdir" value="${ogsadai.dir}/WEB-INF/lib" />
        <property name="ogsadai.schemadir" value="${ogsadai.dir}/schema" />
        <property name="cagrid.deploy.schemadir" value="${ogsadai.schemadir}/cagrid" />
    </target>

    
    <!-- ============================================================== -->
    <!-- Tomcat properties                                              -->
    <!-- ============================================================== -->
    <target name="checkTomcat" depends="setTomcat">
        <condition property="tomcat.not.found">
            <or>
                <not><isset property="ext.tomcat.dir"/></not>
                <equals arg1="${ext.tomcat.dir}" arg2=""/>
            </or>
        </condition>
        <fail message="Tomcat directory is not set in either CATALINA_HOME or ext.tomcat.dir" if="tomcat.not.found"/>
        <echo message="Tomcat: ${ext.tomcat.dir}"/>
    </target>
    <target name="setTomcat" if="env.CATALINA_HOME">
        <property name="ext.tomcat.dir" value="${env.CATALINA_HOME}"/>
    </target>
    

    <!-- ============================================================== -->
    <!-- Globus properties                                              -->
    <!-- ============================================================== -->
    <target name="checkGlobus" depends="setGlobus">
        <condition property="globus.not.found">
            <or>
                <not><isset property="ext.globus.dir"/></not>
                <equals arg1="${ext.globus.dir}" arg2=""/>
            </or>
        </condition>
        <fail message="Globus installation is not set in either GLOBUS_LOCATION or ext.globus.dir" if="globus.not.found"/>
        <echo message="Globus: ${ext.globus.dir}"/>
    </target>
    <target name="setGlobus" if="env.GLOBUS_LOCATION">
        <property name="ext.globus.dir" value="${env.GLOBUS_LOCATION}"/>
    </target>
    
    
    <!-- ============================================================== -->
    <!-- OGSA-DAI properties                                              -->
    <!-- ============================================================== -->
    <!--<target name="checkOGSADAI" depends="setOGSADAI">
        <condition property="ogsadai.not.found">
            <or>
                <not><isset property="ext.ogsadai.dir"/></not>
                <equals arg1="${ext.ogsadai.dir}" arg2=""/>
            </or>
        </condition>
        <fail message="OGSA-DAI installation is not set in either OGSADAI_LOCATION or ext.ogsadai.dir" if="ogsadai.not.found"/>
        <echo message="OGSA-DAI: ${ext.ogsadai.dir}"/>
    </target>
    <target name="setOGSADAI" if="env.OGSADAI_LOCATION">
        <property name="ext.ogsadai.dir" value="${env.OGSADAI_LOCATION}"/>
    </target>-->
    
    
    <!-- ============================================================== -->
    <!-- Creates conf files from examples                               -->
    <!-- ============================================================== -->
    <target name="check_config">
        <condition property="configuration.needed">
            <not>
                <available file="${basedir}/build.properties" />
            </not>
        </condition>
    </target>
    <target name="copyProperties"
            depends="check_config"
            if="configuration.needed"
            description="Creates conf files from examples">
        <echo message="You have not configured build.properties.  Creating from example..." />
        <copy file="${basedir}/build.properties.example"
              tofile="${basedir}/build.properties" />
        <!--<fail message="Please edit ${basedir}/build.properties and set variables appropriate to your environment, before using ant again." />-->
    </target>
	
	<!-- ============================================================= -->
	<!-- Deploy schemas and jar files                                  -->
	<!-- ============================================================= -->
    <target name="deploySchema" depends="prepare">
        <copy todir="${cagrid.deploy.schemadir}/xsd" preservelastmodified="true">
            <fileset dir="${cagrid.schemadir}/xsd" />
        </copy>

        <copy todir="${cagrid.deploy.schemadir}" preservelastmodified="true">
            <fileset dir="${build.schema}/cagrid" />
        </copy>
    </target>


    <target name="deployJars" depends="prepare">
        <copy todir="${ogsadai.libdir}" preservelastmodified="true">
            <fileset dir="${lib.dir}" />
        </copy>

        <copy todir="${ogsadai.libdir}" preservelastmodified="true">
            <fileset dir="${build.lib}" />
        </copy>
    </target>
	
</project>