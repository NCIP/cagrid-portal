<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<bean id="responseFilter" class="gov.nih.nci.cagrid.authorization.impl.CSMNodeFilter">
		<property name="authorizationManager">
			<bean class="gov.nih.nci.security.SecurityServiceProvider"
				factory-method="getAuthorizationManager">
				<constructor-arg value="myapp"/>
			</bean>
		</property>
		<property name="selectorSelector" ref="selectorSelector"/>
		<property name="nodeHandler">
			<bean class="gov.nih.nci.cagrid.authorization.impl.NodeRemovalPENodeHandler"/>
		</property>
	</bean>
	<bean id="selectorSelector" class="gov.nih.nci.cagrid.authorization.impl.OperationPENodeSelectorSelector">
		<property name="mappings">
			<list>
				<bean class="gov.nih.nci.cagrid.authorization.impl.RegExPENodeSelectorMapping">
					<property name="pattern" value=".*getResourceProperty"/>
					<property name="selector" ref="getResourceProperty"/>
				</bean>
			</list>
		</property>
	</bean>
	<bean id="getResourceProperty" class="gov.nih.nci.cagrid.authorization.impl.XPathPENodeSelector">
		<property name="privilege" value="READ"/>
		<property name="xpathMap">
			<map>
				<entry>
					<key>
						<value>/*[local-name(.)='GetResourcePropertyResponse']/*[local-name(.)='messageList']/*[local-name(.)='message']</value>
					</key>
					<bean class="gov.nih.nci.cagrid.authorization.impl.id.XSLTObjectIdGenerator">
						<property name="xsl">
							<value>
								<![CDATA[
					<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
    
    					<xsl:output omit-xml-declaration="yes" method="xml"/>
    
    					<xsl:template match="*[local-name()='message']">
        					{http://cagrid.nci.nih.gov/chat/ChatSessionService}message.<xsl:value-of select="*[local-name()='member']/*[local-name(.)='name']"/>
    					</xsl:template>
					</xsl:stylesheet>
					]]>
							</value>
						</property>
					</bean>
				</entry>
			</map>
		</property>
		
	</bean>
</beans>
