Autocompleter.DWR=Class.create();Autocompleter.DWR.prototype=Object.extend(new Autocompleter.Base(),{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=new Array(0);this.populator=c;if(this.options.afterUpdateElement){this.afterUpdateCallback=this.options.afterUpdateElement;this.options.afterUpdateElement=this.afterUpdateElement.bind(this)}},getUpdatedChoices:function(){this.populator(this,this.getToken())},afterUpdateElement:function(a,b){this.afterUpdateCallback(a,b,this.options.internalArray[this.index])},setChoices:function(a){this.options.array=a;this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:15,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:true,selector:function(m){var h=[];var j=[];var l=m.getToken();var e=0;var g=new Array(0);var f=new Array(0);var b=0;var k=m.options.valueSelector;for(var d=0;d<m.options.array.length&&h.length<m.options.choices;d++){var c=k(m.options.array[d]);var n=m.options.ignoreCase?c.toLowerCase().indexOf(l.toLowerCase()):c.indexOf(l);while(n!=-1){if(n==0&&c.length!=l.length){h.push("<li><strong>"+c.substr(0,l.length)+"</strong>"+c.substr(l.length)+"</li>");g[e++]=m.options.array[d];break}else{if(l.length>=m.options.partialChars&&m.options.partialSearch&&n!=-1){if(m.options.fullSearch||/\s/.test(c.substr(n-1,1))){j.push("<li>"+c.substr(0,n)+"<strong>"+c.substr(n,l.length)+"</strong>"+c.substr(n+l.length)+"</li>");f[b++]=m.options.array[d];break}}}n=m.options.ignoreCase?c.toLowerCase().indexOf(l.toLowerCase(),n+1):c.indexOf(l,n+1)}}if(j.length){h=h.concat(j.slice(0,m.options.choices-h.length))}m.options.internalArray=g.concat(f);m.options.internalArray.reverse();h.reverse();return"<ul>"+h.join("")+"</ul>"},valueSelector:function(b){return b}},a||{})}});