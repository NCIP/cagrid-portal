/**
 * 
 */
package gov.nih.nci.cagrid.portal.portlet.filter;

import java.util.UUID;

import javax.servlet.http.HttpSession;
import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionListener;

import org.springframework.context.ApplicationContext;

/**
 * @author <a href="mailto:joshua.phillips@semanticbits.com">Joshua Phillips</a>
 * 
 */
public class CSRFTokenHttpSessionListener implements HttpSessionListener {

	public static final String CSRF_TOKEN_BEAN_NAME = "crsfTokenName";
	private String csrfTokenName;

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * javax.servlet.http.HttpSessionListener#sessionCreated(javax.servlet.http
	 * .HttpSessionEvent)
	 */
	public void sessionCreated(HttpSessionEvent se) {
		HttpSession sess = se.getSession();
		if (csrfTokenName == null) {
			ApplicationContext ctx = (ApplicationContext) sess
					.getAttribute(
							org.springframework.web.context.WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
			csrfTokenName = (String)ctx.getBean(CSRF_TOKEN_BEAN_NAME);
		}
		String token = UUID.randomUUID().toString();
		sess.setAttribute(csrfTokenName, token);
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * javax.servlet.http.HttpSessionListener#sessionDestroyed(javax.servlet
	 * .http.HttpSessionEvent)
	 */
	public void sessionDestroyed(HttpSessionEvent se) {
		// TODO Auto-generated method stub

	}

}
