<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"
                   logicalFilePath="classpath:cagrid_portal-db-changelog.xml">

    <!--all pre version 2.0 DB changes-->
    <include file="cagrid_portal-db-20-changelog.xml"/>

    <changeSet id="1" author="kherm">
        <tagDatabase tag="version_2.1"/>
    </changeSet>

    <changeSet id="2" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="status_change" columnName="archived"/>
            </not>
        </preConditions>
        <addColumn tableName="status_change">
            <column name="archived" type="bit">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="3" author="kherm">
        <tagDatabase tag="version_2.2"/>
    </changeSet>

    <changeSet id="4" author="kherm">
        <modifyColumn tableName="c_hier_node">
            <column name="description" type="text"/>
        </modifyColumn>
    </changeSet>

    <changeSet id="5" author="kherm">
        <modifyColumn tableName="query_instances">
            <column name="error" type="text"/>
        </modifyColumn>
    </changeSet>

    <changeSet id="6" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="notification_subscriber"/>
            </not>
        </preConditions>
        <createTable tableName="notification_subscriber">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="int">
                <constraints references="portal_users(id)" foreignKeyName="FK345D683C9B17579D"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="7" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="notification_subscriptions"/>
            </not>
        </preConditions>
        <createTable tableName="notification_subscriptions">
            <column name="id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="statusesContainer" type="varchar(255)"/>
            <column name="subscriber_id" type="int">
                <constraints references="notification_subscriber(id)" foreignKeyName="FKDA99AEA24F1130BC"/>
            </column>
            <column name="service_id" type="int">
                <constraints references="grid_services(id)" foreignKeyName="FKDA99AEA26E4B3B1D"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="8" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="portal_users" columnName="delegatedEPR"/>
            </not>
        </preConditions>
        <addColumn tableName="portal_users">
            <column name="delegatedEPR" type="text">
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="9" author="kherm">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="notification_subscriptions" columnName="statusesContainer"/>
        </preConditions>
        <dropColumn tableName="notification_subscriptions" columnName="statusesContainer"/>
    </changeSet>


    <!--delete if previously created (was wrongly created)-->
    <changeSet id="10-pre" author="kherm">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="notification_subscriber" columnName="haltSubscriptions"/>
        </preConditions>
        <dropColumn tableName="notification_subscriber" columnName="haltSubscriptions"/>
    </changeSet>
    <!--or else create it-->
    <changeSet id="10" author="kherm" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="notification_subscriber" columnName="haltSubscriptions"/>
            </not>
        </preConditions>
        <addColumn tableName="notification_subscriber">
            <column name="haltSubscriptions" type="bit">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>


    <changeSet id="11" author="kherm" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="notification_log"/>
            </not>
        </preConditions>
        <createTable tableName="notification_log">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="notificationType" type="varchar(255)"/>
            <column name="sendSuccessful" type="bit"/>
            <column name="timestamp" type="datetime"/>
            <column name="subscriber_id" type="integer">
                <constraints references="notification_subscriber(id)" foreignKeyName="FKDA99AEA26E4B3B1D2"/>
            </column>
        </createTable>
    </changeSet>

    <!--catalog tables-->
    <changeSet id="12" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_citations"/>
            </not>
        </preConditions>
        <createTable tableName="cat_citations">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="citation" type="varchar(255)"/>
            <column name="pubMedID" type="varchar(255)"/>
            <column name="createdAt" type="datetime"/>
        </createTable>
    </changeSet>

    <changeSet id="13" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_comments">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="commentText" type="varchar(255)"/>
            <column name="commnentor_id" type="integer">
                <constraints foreignKeyName="FKF71F003DF810F8C8" references="cat_entry(id)"/>
            </column>
            <column name="author_id" type="integer">
                <constraints foreignKeyName="FKF71F003DFBD049DD" references="portal_users(id)"/>
            </column>
            <column name="createdAt" type="datetime"/>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="13-a">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_comments" columnName="commnentor_id"/>
        </preConditions>
        <dropColumn tableName="cat_comments" columnName="commnentor_id"/>
    </changeSet>
    <changeSet author="kherm (generated)" id="13-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_comments" columnName="commentor_id"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_comments">
            <column name="commentor_id" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="13-c">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKF71F003DF496AAF2"/>
            </not>
        </preConditions>
        <createIndex indexName="FKF71F003DF496AAF2" tableName="cat_comments" unique="false">
            <column name="commentor_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="13-d">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FKF71F003DF810F8C8"/>
        </preConditions>
        <dropIndex indexName="FKF71F003DF810F8C8" tableName="cat_comments"/>
    </changeSet>

    <changeSet id="14" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="catalog_type" type="varchar(31)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="name" type="varchar(255)"/>
            <column name="numViews" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="published" type="bit">
                <constraints nullable="false"/>
            </column>
            <column name="updatedAt" type="datetime"/>
            <column name="lastViewedAt" type="datetime"/>
            <column name="createdAt" type="datetime"/>
            <column name="workflowStatus" type="integer"/>
            <column name="addressPublic" type="bit"/>
            <column name="countryCode" type="varchar(255)"/>
            <column name="emailAddress" type="varchar(255)"/>
            <column name="emailAddressPublic" type="bit"/>
            <column name="latitude" type="float"/>
            <column name="locality" type="varchar(255)"/>
            <column name="longitude" type="float"/>
            <column name="phoneNumber" type="varchar(255)"/>
            <column name="phoneNumberPublic" type="bit"/>
            <column name="postalCode" type="varchar(255)"/>
            <column name="stateProvince" type="varchar(255)"/>
            <column name="street1" type="varchar(255)"/>
            <column name="street2" type="varchar(255)"/>
            <column name="webSite" type="tinyblob"/>
            <column name="firstName" type="varchar(255)"/>
            <column name="lastName" type="varchar(255)"/>
            <column name="middleName" type="varchar(255)"/>
            <column name="salutation" type="varchar(255)"/>
            <column name="suffix" type="varchar(255)"/>
            <column name="end" type="datetime"/>
            <column name="start" type="datetime"/>
            <column name="contributor_id" type="integer">
                <constraints foreignKeyName="FK52FB32C9A44A9FF9" references="portal_users(id)"/>
            </column>
            <column name="author_id" type="integer">
                <constraints foreignKeyName="FK52FB32C9FBD049DD" references="portal_users(id)"/>
            </column>
            <column name="terminology_id" type="integer">
                <constraints foreignKeyName="FK52FB32C9E573C12E" references="cat_terminology(id)"/>
            </column>
            <column name="provenance_id" type="integer">
                <constraints foreignKeyName="FK52FB32C9F60411FA" references="cat_provenance_graph(id)"/>
            </column>
            <column name="grid_service_id" type="integer">
                <constraints foreignKeyName="FK52FB32C940575DB6" references="grid_services(id)"/>
            </column>
            <column name="participant_id" type="integer">
                <constraints foreignKeyName="FK52FB32C91E7B9083" references="participants(id)"/>
            </column>
            <column name="person_id" type="integer">
                <constraints foreignKeyName="FK52FB32C9D6B703D3" references="portal_users(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="15" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_cat_citations"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_cat_citations">
            <column name="citationOf_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK152C6A4DF936801" references="cat_entry(id)"/>
            </column>
            <column name="citations_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK152C6A4DD915D2E1" references="cat_citations(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="16" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_cat_comments">
            <column name="cat_entry_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKBF27C5F3C5A01856" references="cat_entry(id)"/>
            </column>
            <!--too should be unique-->
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKBF27C5F3488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="16-a">
        <preConditions onFail="MARK_RAN" onError="MARK_RAN">
            <not>
                <indexExists indexName="FKBF27C5F3488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKBF27C5F3488AC7F9" tableName="cat_entry_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="17" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_cat_entry"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_cat_entry">
            <column name="knowledgeCenterInstitutionOf_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKA1F138D3599AF85E" references="cat_entry(id)"/>
            </column>
            <column name="knowledgeCenterInstitutions_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKA1F138D3CE47EB71" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="17a" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_terminology"/>
            </not>
        </preConditions>
        <createTable tableName="cat_terminology">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="identifier" type="varchar(255)"/>
            <column name="label" type="varchar(255)"/>
            <column name="serviceUrl" type="tinyblob"/>
            <column name="sharedQueryCriteria" type="tinyblob"/>
        </createTable>
    </changeSet>

    <changeSet id="17b" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_terms"/>
            </not>
        </preConditions>
        <createTable tableName="cat_terms">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="identifer" type="varchar(255)"/>
            <column name="label" type="varchar(255)"/>
            <column name="terminology" type="integer">
                <constraints foreignKeyName="FK53CA73DE289535BA" references="cat_terminology(id)"/>
            </column>
            <column name="terms_fk" type="integer">
                <constraints foreignKeyName="FK53CA73DEE5AF2F22" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="18" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_cat_entry"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_cat_entry">
            <column name="cat_entry_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKA2C079E8BAF5B81" references="cat_entry(id)"/>
            </column>
            <column name="typesOfCancer_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKA2C079E8B30323C2"
                             references="cat_terms(id)"/>
            </column>
            <column name="terms_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKA2C079E85D72F16B"
                             references="cat_terms(id)"/>
            </column>
            <column name="areasOfFocus_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKA2C079E82DB9B157" references="cat_terms(id)"/>
            </column>
        </createTable>
    </changeSet>


    <changeSet id="19" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_fav_of_role"/>
            </not>
        </preConditions>
        <createTable tableName="cat_fav_of_role">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="person_catalog_id" type="integer">
                <constraints foreignKeyName="FKAD8EEDD166CCEC30" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="20" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_fav_role"/>
            </not>
        </preConditions>
        <createTable tableName="cat_fav_role">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="catalog_id" type="integer">
                <constraints foreignKeyName="FK58C78963467B6FFB" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="21" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_files"/>
            </not>
        </preConditions>
        <createTable tableName="cat_files">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="varchar(255)"/>
            <column name="fileType" type="varchar(255)"/>
            <column name="name" type="varchar(255)"/>
            <column name="sizeInBytes" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="url" type="tinyblob"/>
            <column name="catalog_id" type="integer">
                <constraints foreignKeyName="FK5306E4CEA9952906" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="22" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_files_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_files_cat_comments">
            <column name="cat_files_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK882440E930E6DD4" references="cat_files(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK882440E488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="22-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK882440E488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FK882440E488AC7F9" tableName="cat_files_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="23" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_hyperlinks"/>
            </not>
        </preConditions>
        <createTable tableName="cat_hyperlinks">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="varchar(255)"/>
            <column name="updatedAt" type="datetime"/>
            <column name="url" type="tinyblob"/>
            <column name="catalog_id" type="integer">
                <constraints foreignKeyName="FKE1FAE8D6A9952906" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="24" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_hyperlinks_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_hyperlinks_cat_comments">
            <column name="cat_hyperlinks_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKE1FAE8D6A9952906" references="cat_hyperlinks(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKEC230D06488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="24-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKEC230D06488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKEC230D06488AC7F9" tableName="cat_hyperlinks_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="25" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_input_desc"/>
            </not>
        </preConditions>
        <createTable tableName="cat_input_desc">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="label" type="varchar(255)"/>
            <column name="orderLevel" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="umlattribute_fk" type="integer">
                <constraints foreignKeyName="FKC86761EFB1C98069" references="cat_entry(id)"/>
            </column>
            <column name="sharedQueryCatalog_fk" type="integer">
                <constraints foreignKeyName="FKC86761EFE3BB879E" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="25-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_input_desc" columnName="input_desc_type"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_input_desc">
            <column defaultValue="" name="input_desc_type" type="VARCHAR(31)"/>
        </addColumn>
    </changeSet>


    <changeSet id="26" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_input_desc_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_input_desc_cat_comments">
            <column name="cat_input_desc_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKB82BE48D488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="26-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKB82BE48D488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKB82BE48D488AC7F9" tableName="cat_input_desc_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="26-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKB82BE48D4F354E98"/>
            </not>
        </preConditions>
        <createIndex indexName="FKB82BE48D4F354E98" tableName="cat_input_desc_cat_comments" unique="false">
            <column name="cat_input_desc_id"/>
        </createIndex>
    </changeSet>


    <changeSet id="27" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_lov_crit_values"/>
            </not>
        </preConditions>
        <createTable tableName="cat_lov_crit_values">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="help" type="varchar(255)"/>
            <column name="label" type="varchar(255)"/>
            <column name="value" type="varchar(255)"/>
            <column name="descriptor_id" type="integer">
                <constraints foreignKeyName="FK98E5FDD2D1A239B4" references="cat_input_desc(id)"/>
            </column>
            <column name="sharedQueryCatalog_fk" type="integer"/>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="27-a">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_lov_crit_values" columnName="sharedQueryCatalog_fk"/>
        </preConditions>
        <dropColumn columnName="sharedQueryCatalog_fk"
                    tableName="cat_lov_crit_values"/>
    </changeSet>

    <changeSet id="28" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_output_column_desc"/>
            </not>
        </preConditions>
        <createTable tableName="cat_output_column_desc">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="type" type="varchar(31)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="label" type="varchar(255)"/>
            <column name="orderLevel" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="query_id" type="integer">
                <constraints foreignKeyName="FKA91622A527E94122" references="cat_entry(id)"/>
            </column>
            <column name="umlAttribute_id" type="integer">
                <constraints foreignKeyName="FKA91622A5B1C980BF" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="28-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_output_column_desc" columnName="output_col_type"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_output_column_desc">
            <column defaultValue="" name="output_col_type" type="VARCHAR(31)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="1245087025873-13">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_output_column_desc" columnName="type"/>
        </preConditions>
        <dropColumn columnName="type" tableName="cat_output_column_desc"/>
    </changeSet>

    <changeSet id="29" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_output_column_desc_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_output_column_desc_cat_comments">
            <column name="cat_output_column_desc_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKCD227B9722BA2EA7"
                             references="cat_output_column_desc(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKCD227B97488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="29-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKCD227B97488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKCD227B97488AC7F9" tableName="cat_output_column_desc_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="30" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_output_desc"/>
            </not>
        </preConditions>
        <createTable tableName="cat_output_desc">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="type" type="varchar(31)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="output_id" type="integer">
                <constraints foreignKeyName="FK1203E42697F9807D" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="30-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_output_desc" columnName="output_desc_type"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_output_desc">
            <column defaultValue="" name="output_desc_type" type="VARCHAR(31)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="1245087025873-14">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_output_desc" columnName="type"/>
        </preConditions>
        <dropColumn columnName="type" tableName="cat_output_desc"/>
    </changeSet>


    <changeSet id="31" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_output_desc_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_output_desc_cat_comments">
            <column name="cat_output_desc_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK1318F3B6D3627350" references="cat_output_desc(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK1318F3B6488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="31-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK1318F3B6488AC7F9"/>
            </not>
        </preConditions>

        <createIndex indexName="FK1318F3B6488AC7F9" tableName="cat_output_desc_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="32" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_provenance_graph"/>
            </not>
        </preConditions>
        <createTable tableName="cat_provenance_graph">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="33" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_output_desc_cat_output_column_desc"/>
            </not>
        </preConditions>
        <createTable tableName="cat_output_desc_cat_output_column_desc">
            <column name="cat_output_desc_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK5794D2DEFD6F09B5" references="cat_output_desc(id)"/>
            </column>
            <column name="columns_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK5794D2DEDE5E0E6F"
                             references="cat_output_column_desc(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="33-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK5794D2DEDE5E0E6F"/>
            </not>
        </preConditions>
        <createIndex indexName="FK5794D2DEDE5E0E6F" tableName="cat_output_desc_cat_output_column_desc" unique="false">
            <column name="columns_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="34" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_provenance_graph_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_provenance_graph_cat_comments">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cat_provenance_graph_id" type="integer">
                <constraints foreignKeyName="FKF748B3C312823222" references="cat_provenance_graph(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKF748B3C3488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <!--<changeSet author="kherm (generated)" id="34-a">-->
    <!--<preConditions onFail="MARK_RAN">-->
    <!--<primaryKeyExists tableName="cat_provenance_graph_cat_comments"/>-->
    <!--</preConditions>-->
    <!--<dropPrimaryKey tableName="cat_provenance_graph_cat_comments"/>-->
    <!--</changeSet>-->
    <changeSet author="kherm (generated)" id="34-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKF748B3C3488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKF748B3C3488AC7F9" tableName="cat_provenance_graph_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="34-c">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="id" tableName="cat_provenance_graph_cat_comments"/>
        </preConditions>
        <dropColumn columnName="id"
                    tableName="cat_provenance_graph_cat_comments"/>
    </changeSet>


    <changeSet id="35" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_ratings"/>
            </not>
        </preConditions>
        <createTable tableName="cat_ratings">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="rating" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="updatedAt" type="datetime"/>
            <column name="catalog_id" type="integer">
                <constraints foreignKeyName="FK1A77730DA9952906" references="cat_entry(id)"/>
            </column>
            <column name="person_catalog_id" type="integer">
                <constraints foreignKeyName="FK1A77730D3B33325" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="36" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_ratings_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_ratings_cat_comments">
            <column name="cat_ratings_id" type="integer" autoIncrement="true">
                <constraints nullable="false" foreignKeyName="FK727D142FF914A456" references="cat_ratings(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK727D142F488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="36-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK727D142F488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FK727D142F488AC7F9" tableName="cat_ratings_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="37" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relations_shared_query"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relations_shared_query">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="moreInformation" type="varchar(255)"/>
            <column name="role" type="varchar(255)"/>
            <column name="updatedAt" type="datetime"/>
            <column name="tool_id" type="integer">
                <constraints foreignKeyName="FK6E13443FC3D65EDF" references="cat_entry(id)"/>
            </column>
            <column name="sharedQuery_id" type="integer">
                <constraints foreignKeyName="FK6E13443F7A1B887" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="38" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relations_shared_query_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relations_shared_query_cat_comments">
            <column name="cat_relations_shared_query_id" type="integer" autoIncrement="true">
                <constraints nullable="false" foreignKeyName="FK41AE443DB3DE95D7"
                             references="cat_relations_shared_query(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK392F2989488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="38-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK41AE443D488AC7F9"/>
            </not>
        </preConditions>

        <createIndex indexName="FK41AE443D488AC7F9" tableName="cat_relations_shared_query_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="39" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relations_temporal"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relations_temporal">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="moreInformation" type="varchar(255)"/>
            <column name="role" type="varchar(255)"/>
            <column name="updatedAt" type="datetime"/>
            <column name="since" type="datetime"/>
            <column name="until" type="datetime"/>
        </createTable>
    </changeSet>

    <changeSet id="40" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relations_temporal_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relations_temporal_cat_comments">
            <column name="cat_relations_temporal_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK392F298955A0A20D"
                             references="cat_relations_temporal(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK392F2989488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="40-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK392F2989488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FK392F2989488AC7F9" tableName="cat_relations_temporal_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="41" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relationship_instance"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relationship_instance">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="since" type="datetime"/>
            <column name="until" type="datetime"/>
            <column name="updatedAt" type="datetime"/>
            <column name="catalog_relationship_type_id" type="integer">
                <constraints foreignKeyName="FKD62B6B131C882B56" references="cat_relationship_type(id)"/>
            </column>
            <column name="catalog_instance_roleA" type="integer">
                <constraints foreignKeyName="FKD62B6B1374778D37" references="cat_role_instance(id)"/>
            </column>
            <column name="catalog_instance_roleB" type="integer">
                <constraints foreignKeyName="FKD62B6B1374778D38" references="cat_role_instance(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="41-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_relationship_instance" columnName="author_id"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_relationship_instance">
            <column name="author_id" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="41-b">
        <preConditions onError="MARK_RAN" onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKD62B6B13FBD049DD"/>
            </not>
        </preConditions>
        <createIndex indexName="FKD62B6B13FBD049DD" tableName="cat_relationship_instance" unique="false">
            <column name="author_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="42" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relationship_instance_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relationship_instance_cat_comments">
            <column name="cat_relationship_instance_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKB82ED5E9971F3A59"
                             references="cat_relationship_instance(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKB82ED5E9488AC7F9" references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="43" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relationship_type"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relationship_type">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="varchar(255)"/>
            <column name="name" type="varchar(255)"/>
            <column name="temporal" type="bit">
                <constraints nullable="false"/>
            </column>
            <column name="catalog_role_typeA" type="integer">
                <constraints foreignKeyName="FK35C654B8F7FF4939" references="cat_role_type(id)"/>
            </column>
            <column name="catalog_role_typeB" type="integer">
                <constraints foreignKeyName="FK35C654B8F7FF493A" references="cat_role_type(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="43-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_relationship_type" columnName="parent_id"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_relationship_type">
            <column name="parent_id" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="43-c">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK35C654B8E9A2A287"/>
            </not>
        </preConditions>
        <createIndex indexName="FK35C654B8E9A2A287" tableName="cat_relationship_type" unique="false">
            <column name="parent_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="44" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relationship_type_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relationship_type_cat_comments">
            <column name="cat_relationship_type_id" type="integer">
                <constraints nullable="false" foreignKeyName="FK73498064413A33B9"
                             references="cat_relationship_type(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FK73498064488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="44-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK73498064488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FK73498064488AC7F9" tableName="cat_relationship_type_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>


    <changeSet id="45" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_role_instance"/>
            </not>
        </preConditions>
        <createTable tableName="cat_role_instance">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="varchar(255)"/>
            <column name="updatedAt" type="datetime"/>
            <column name="source_id" type="integer">
                <constraints foreignKeyName="FK17004D95C22809C4" references="cat_entry(id)"/>
            </column>
            <column name="target_id" type="integer">
                <constraints foreignKeyName="FK17004D95F6C7048E" references="cat_entry(id)"/>
            </column>
            <column name="role_type" type="integer">
                <constraints foreignKeyName="FK17004D95BA5E4358" references="cat_role_type(id)"/>
            </column>
            <column name="relationship_fk" type="integer">
                <constraints foreignKeyName="FK17004D952B5720BE" references="cat_relationship_instance(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="45-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_role_instance" columnName="entry_id"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_role_instance">
            <column name="entry_id" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="45-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK17004D95AA98F60D"/>
            </not>
        </preConditions>
        <createIndex indexName="FK17004D95AA98F60D" tableName="cat_role_instance" unique="false">
            <column name="entry_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="45-c">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FK17004D95C22809C4"/>
        </preConditions>
        <dropIndex indexName="FK17004D95C22809C4" tableName="cat_role_instance"/>
    </changeSet>
    <changeSet author="kherm (generated)" id="45-d">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FK17004D95F6C7048E"/>
        </preConditions>
        <dropIndex indexName="FK17004D95F6C7048E" tableName="cat_role_instance"/>
    </changeSet>


    <changeSet id="46" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_relationship_type_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_relationship_type_cat_comments">
            <column name="cat_role_instance_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKEE7996A76B6E91D5" references="cat_role_instance(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKEE7996A7488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>


    <changeSet id="47" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_role_type"/>
            </not>
        </preConditions>
        <createTable tableName="cat_role_type">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="varchar(255)"/>
            <column name="maxCardinality" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="minCardinality" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="updatedAt" type="datetime"/>
            <column name="type_id" type="integer">
                <constraints foreignKeyName="FK59E4C83A3B62D1F7" references="cat_relationship_type(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="47-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_role_type" columnName="type"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_role_type">
            <column name="type" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>


    <changeSet id="48" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_role_type_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_role_type_cat_comments">
            <column name="cat_role_type_id" type="integer">
                <constraints nullable="false" foreignKeyName="FKC41E5022488AC7F9" references="cat_role_type(id)"/>
            </column>
            <column name="comments_id" type="integer">
                <constraints unique="true" nullable="false" foreignKeyName="FKC41E5022488AC7F9"
                             references="cat_comments(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="50-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKC41E5022488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKC41E5022488AC7F9" tableName="cat_role_type_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="51" author="kherm">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_tool_applications"/>
            </not>
        </preConditions>
        <createTable tableName="cat_tool_applications">
            <column name="id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="tool_type" type="varchar(31)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="term_id" type="integer">
                <constraints foreignKeyName="FK1C385C414EFCD066" references="cat_terms(id)"/>
            </column>
            <column name="tool_catalog_id" type="integer">
                <constraints foreignKeyName="FK1C385C411B32C9C5" references="cat_entry(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="52" author="kherm">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="description"/>
        </preConditions>
        <modifyColumn tableName="cat_entry">
            <column name="description" type="text"/>
        </modifyColumn>
    </changeSet>

    <changeSet id="53" author="kherm">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="end"/>
        </preConditions>
        <renameColumn tableName="cat_entry" columnDataType="datetime" oldColumnName="end" newColumnName="endDate"/>
    </changeSet>

    <!--changeset 53 might fail. Will drop and add column-->
    <changeSet author="kherm (generated)" id="53-a">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="end"/>
        </preConditions>
        <dropColumn columnName="end" tableName="cat_entry"/>
    </changeSet>
    <changeSet author="kherm (generated)" id="53-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="endDate"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="endDate" type="datetime"/>
        </addColumn>
    </changeSet>

    <changeSet id="54" author="kherm">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="start"/>
        </preConditions>
        <renameColumn tableName="cat_entry" columnDataType="datetime" oldColumnName="start" newColumnName="startDate"/>
    </changeSet>

    <!--changeset 54 might fail. Will drop and add column-->
    <changeSet author="kherm (generated)" id="54-a">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="start"/>
        </preConditions>
        <dropColumn columnName="start" tableName="cat_entry"/>
    </changeSet>
    <changeSet author="kherm (generated)" id="54-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="startDate"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="startDate" type="DATETIME"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="55">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_cat_terms"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_cat_terms">
            <column name="cat_entry_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="typesOfCancer_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="terms_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="areasOfFocus_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="55-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="typesOfCancer_id"/>
            </not>
        </preConditions>
        <createIndex indexName="typesOfCancer_id" tableName="cat_entry_cat_terms" unique="true">
            <column name="typesOfCancer_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="55-b">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKA2C079E82DB9B157"/>
            </not>
            <columnExists tableName="cat_entry_cat_terms" columnName="areasOfFocus_id"/>
        </preConditions>
        <createIndex indexName="FKA2C079E82DB9B157" tableName="cat_entry_cat_terms" unique="false">
            <column name="areasOfFocus_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="55-c">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKA2C079E85D72F16B"/>
            </not>
            <columnExists tableName="cat_entry_cat_terms" columnName="terms_id"/>
        </preConditions>
        <createIndex indexName="FKA2C079E85D72F16B" tableName="cat_entry_cat_terms" unique="false">
            <column name="terms_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="55-d">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKA2C079E8B30323C2"/>
            </not>
        </preConditions>
        <createIndex indexName="FKA2C079E8B30323C2" tableName="cat_entry_cat_terms" unique="false">
            <column name="typesOfCancer_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="55-e">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKA2C079E8BAF5B81"/>
            </not>
        </preConditions>
        <createIndex indexName="FKA2C079E8BAF5B81" tableName="cat_entry_cat_terms" unique="false">
            <column name="cat_entry_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="55-f">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="terms_id"/>
            </not>
            <columnExists tableName="cat_entry_cat_terms" columnName="terms_id"/>
        </preConditions>
        <createIndex indexName="terms_id" tableName="cat_entry_cat_terms" unique="true">
            <column name="terms_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="56">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_role_instance_cat_comments"/>
            </not>
        </preConditions>
        <createTable tableName="cat_role_instance_cat_comments">
            <column name="cat_role_instance_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="comments_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="56-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="comments_id"/>
            </not>
        </preConditions>
        <createIndex indexName="comments_id" tableName="cat_role_instance_cat_comments" unique="true">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="56-b">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_role_instance" columnName="source_id"/>
        </preConditions>
        <dropColumn columnName="source_id" tableName="cat_role_instance"/>
    </changeSet>
    <changeSet author="kherm (generated)" id="56-c">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_role_instance" columnName="target_id"/>
        </preConditions>
        <dropColumn columnName="target_id" tableName="cat_role_instance"/>
    </changeSet>
    <changeSet author="kherm (generated)" id="56-d">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKEE7996A7488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKEE7996A7488AC7F9" tableName="cat_role_instance_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="56-e">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKEE7996A76B6E91D5"/>
            </not>
        </preConditions>
        <createIndex indexName="FKEE7996A76B6E91D5" tableName="cat_role_instance_cat_comments" unique="false">
            <column name="cat_role_instance_id"/>
        </createIndex>
    </changeSet>


    <changeSet author="kherm (generated)" id="57">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="idp"/>
            </not>
        </preConditions>
        <createTable tableName="idp">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="label" type="VARCHAR(255)"/>
            <column name="url" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="58">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="idp_authn"/>
            </not>
        </preConditions>
        <createTable tableName="idp_authn">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="default_flag" type="BIT"/>
            <column name="gridCredential" type="TEXT"/>
            <column name="identity" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="username" type="VARCHAR(255)"/>
            <column name="idp_id" type="INT">
                <constraints foreignKeyName="FK306B35BCD7A2B1AB"
                             references="idp(id)"/>
            </column>
            <column name="portal_user_id" type="INT">
                <constraints foreignKeyName="FK306B35BC64EE5ACA"
                             references="portal_users(id)"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kherm (generated)" id="58-b">
        <preConditions onFail="MARK_RAN" onError="MARK_RAN">
            <not>
                <indexExists indexName="FK306B35BCD7A2B1AB"/>
            </not>
        </preConditions>
        <createIndex indexName="FK306B35BCD7A2B1AB" tableName="idp_authn" unique="false">
            <column name="idp_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="kherm (generated)" id="58-a">
        <preConditions onFail="MARK_RAN" onError="MARK_RAN">
            <not>
                <indexExists indexName="FK306B35BC64EE5ACA"/>
            </not>
        </preConditions>
        <createIndex indexName="FK306B35BC64EE5ACA" tableName="idp_authn" unique="false">
            <column name="portal_user_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="59">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="portal_users" columnName="catalog_id"/>
            </not>
        </preConditions>
        <addColumn tableName="portal_users">
            <column name="catalog_id" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm (generated)" id="59-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK3ACE7875467B6FFB"/>
            </not>
        </preConditions>
        <createIndex indexName="FK3ACE7875467B6FFB" tableName="portal_users" unique="false">
            <column name="catalog_id"/>
        </createIndex>
    </changeSet>


    <changeSet author="kherm" id="60">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="cql_id"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="cql_id" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="kherm" id="60-a">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK52FB32C9A0F2F220"/>
            </not>
        </preConditions>
        <createIndex indexName="FK52FB32C9A0F2F220" tableName="cat_entry" unique="false">
            <column name="cql_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_aofterms"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_aofterms">
            <column name="entry_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="term_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_terms"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_terms">
            <column name="entry_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="term_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-3">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cat_entry_tocterms"/>
            </not>
        </preConditions>
        <createTable tableName="cat_entry_tocterms">
            <column name="entry_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="term_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="images"/>
            </not>
        </preConditions>
        <createTable tableName="images">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="data" type="BLOB"/>
            <column name="format" type="INT"/>
            <column name="height" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="width" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-5">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="image_id" tableName="cat_entry"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="image_id" type="INT"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-6">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="thumbnail_id" tableName="cat_entry"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="thumbnail_id" type="INT"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-7">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="identifier" tableName="cat_terms"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_terms">
            <column name="identifier" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-8">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_input_desc" columnName="input_desc_type"/>
        </preConditions>
        <addNotNullConstraint columnDataType="VARCHAR(31)" columnName="input_desc_type" defaultNullValue=""
                              tableName="cat_input_desc"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-9">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_output_column_desc" columnName="output_col_type"/>
        </preConditions>
        <addNotNullConstraint columnDataType="VARCHAR(31)" columnName="output_col_type" defaultNullValue=""
                              tableName="cat_output_column_desc"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-10">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_output_desc" columnName="output_desc_type"/>
        </preConditions>
        <addNotNullConstraint columnDataType="VARCHAR(31)" columnName="output_desc_type" defaultNullValue=""
                              tableName="cat_output_desc"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-11">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_provenance_graph_cat_comments" columnName="cat_provenance_graph_id"/>
        </preConditions>
        <addNotNullConstraint columnDataType="INT" columnName="cat_provenance_graph_id" defaultNullValue=""
                              tableName="cat_provenance_graph_cat_comments"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-12">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="notification_log" columnName="sendSuccessful"/>
        </preConditions>
        <addNotNullConstraint columnDataType="BIT" columnName="sendSuccessful" defaultNullValue=""
                              tableName="notification_log"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-13">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="error" tableName="query_instances"/>
        </preConditions>
        <modifyColumn tableName="query_instances">
            <column name="error" type="text"/>
        </modifyColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-14">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK52FB32C9A3362F2E"/>
            </not>
        </preConditions>
        <createIndex indexName="FK52FB32C9A3362F2E" tableName="cat_entry" unique="false">
            <column name="image_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-15">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK52FB32C9C12F11FD"/>
            </not>
        </preConditions>
        <createIndex indexName="FK52FB32C9C12F11FD" tableName="cat_entry" unique="false">
            <column name="thumbnail_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-16">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK3525B454EFCD066"/>
            </not>
        </preConditions>
        <createIndex indexName="FK3525B454EFCD066" tableName="cat_entry_aofterms" unique="false">
            <column name="term_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-17">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK3525B45AA98F60D"/>
            </not>
        </preConditions>
        <createIndex indexName="FK3525B45AA98F60D" tableName="cat_entry_aofterms" unique="false">
            <column name="entry_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-18">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="entry_id"/>
            </not>
        </preConditions>
        <createIndex indexName="entry_id" tableName="cat_entry_aofterms" unique="true">
            <column name="entry_id"/>
            <column name="term_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-19">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK13C0E4914EFCD066"/>
            </not>
        </preConditions>
        <createIndex indexName="FK13C0E4914EFCD066" tableName="cat_entry_terms" unique="false">
            <column name="term_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-20">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK13C0E491AA98F60D"/>
            </not>
        </preConditions>
        <createIndex indexName="FK13C0E491AA98F60D" tableName="cat_entry_terms" unique="false">
            <column name="entry_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-21a" failOnError="false">
        <dropIndex indexName="entry_id-1" tableName="cat_entry_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-21">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="entry_id-1"/>
            </not>
        </preConditions>
        <createIndex indexName="entry_id-1" tableName="cat_entry_terms" unique="true">
            <column name="entry_id"/>
            <column name="term_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-22">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKB3EA25F54EFCD066"/>
            </not>
        </preConditions>
        <createIndex indexName="FKB3EA25F54EFCD066" tableName="cat_entry_tocterms" unique="false">
            <column name="term_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-23">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKB3EA25F5AF4884AD"/>
            </not>
        </preConditions>
        <createIndex indexName="FKB3EA25F5AF4884AD" tableName="cat_entry_tocterms" unique="false">
            <column name="entry_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-24">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists schemaName="cat_entry_tocterms" indexName="entry_id-2"/>
            </not>
        </preConditions>
        <createIndex indexName="entry_id-2" tableName="cat_entry_tocterms" unique="true">
            <column name="entry_id"/>
            <column name="term_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-25">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists schemaName="cat_relationship_instance_cat_comments" indexName="comments_id-1"/>
            </not>
        </preConditions>
        <createIndex indexName="comments_id-1" tableName="cat_relationship_instance_cat_comments" unique="true">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-26">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists schemaName="cat_role_instance_cat_comments" indexName="comments_id-2"/>
            </not>
        </preConditions>
        <createIndex indexName="comments_id-2" tableName="cat_role_instance_cat_comments" unique="true">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-27">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FKC41E5022488AC7F9"/>
            </not>
        </preConditions>
        <createIndex indexName="FKC41E5022488AC7F9" tableName="cat_role_type_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-28">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FKA2C079E82DB9B157"/>
        </preConditions>
        <dropIndex indexName="FKA2C079E82DB9B157" tableName="cat_entry_cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-29">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FKA2C079E85D72F16B"/>
        </preConditions>
        <dropIndex indexName="FKA2C079E85D72F16B" tableName="cat_entry_cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-30">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="terms_id"/>
        </preConditions>
        <dropIndex indexName="terms_id" tableName="cat_entry_cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-31">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FK53CA73DEE5AF2F22"/>
        </preConditions>
        <dropIndex indexName="FK53CA73DEE5AF2F22" tableName="cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-32">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FK3ACE7875467B6FFB"/>
        </preConditions>
        <dropIndex indexName="FK3ACE7875467B6FFB" tableName="portal_users"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-33">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="areasOfFocus_id" tableName="cat_entry_cat_terms"/>
        </preConditions>
        <dropColumn columnName="areasOfFocus_id" tableName="cat_entry_cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-34">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="terms_id" tableName="cat_entry_cat_terms"/>
        </preConditions>
        <dropColumn columnName="terms_id" tableName="cat_entry_cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-35">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="identifer" tableName="cat_terms"/>
        </preConditions>
        <dropColumn columnName="identifer" tableName="cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-36">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="terms_fk" tableName="cat_terms"/>
        </preConditions>
        <dropColumn columnName="terms_fk" tableName="cat_terms"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="61-37">
        <preConditions onFail="MARK_RAN">
            <columnExists columnName="catalog_id" tableName="portal_users"/>
        </preConditions>
        <dropColumn columnName="catalog_id" tableName="portal_users"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="62">
        <preConditions onFail="MARK_RAN">
            <indexExists indexName="FK52FB32C9A0F2F220"/>
        </preConditions>
        <dropIndex indexName="FK52FB32C9A0F2F220" tableName="cat_entry"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="63">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="cql_id"/>
        </preConditions>
        <dropColumn columnName="cql_id" tableName="cat_entry"/>
    </changeSet>

    <changeSet author="kherm (generated)" id="64">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="portal_url"/>
        </preConditions>
        <dropColumn columnName="portal_url" tableName="cat_entry"/>
    </changeSet>

    <changeSet author="kherm" id="65">
        <update tableName="cat_entry">
            <column name="catalog_type" value="tools"/>
            <where>catalog_type='tool'</where>
        </update>
    </changeSet>

    <changeSet author="kherm (generated)" id="66">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="communityUrl"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="communityUrl" type="TINYBLOB"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="query_result_cell"/>
            </not>
        </preConditions>
        <createTable tableName="query_result_cell">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="value" type="TEXT"/>
            <column name="row_id" type="INT"/>
            <column name="column_id" type="INT"/>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="query_result_col"/>
            </not>
        </preConditions>
        <createTable tableName="query_result_col">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="table_id" type="INT"/>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-3">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="query_result_data"/>
            </not>
        </preConditions>
        <createTable tableName="query_result_data">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="data" type="BLOB"/>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="query_result_row"/>
            </not>
        </preConditions>
        <createTable tableName="query_result_row">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="serviceUrl" type="VARCHAR(255)"/>
            <column name="table_id" type="INT"/>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-5">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="query_result_table"/>
            </not>
        </preConditions>
        <createTable tableName="query_result_table">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="data_id" type="INT"/>
            <column name="instance_id" type="INT"/>
        </createTable>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-6">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="featured"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="featured" type="BIT"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-7">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="portalUrl"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="portalUrl" type="TINYBLOB"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-8">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="projectLongName"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="projectLongName" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-9">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="query_id"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="query_id" type="INT"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-10">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="cat_entry" columnName="version"/>
            </not>
        </preConditions>
        <addColumn tableName="cat_entry">
            <column name="version" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-11">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="query_id"/>
            <not>
                <indexExists indexName="cat_entry_querid_idx" schemaName="cat_entry"/>
            </not>
        </preConditions>
        <createIndex indexName="cat_entry_querid_idx" tableName="cat_entry" unique="false">
            <column name="query_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-12">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_relationship_instance_cat_comments" columnName="comments_id"/>
            <not>
                <indexExists indexName="cat_relationship_instance_cat_comments_id_idx"
                             schemaName="cat_relationship_instance_cat_comments"/>
            </not>
        </preConditions>
        <createIndex indexName="cat_relationship_instance_cat_comments_id_idx"
                     tableName="cat_relationship_instance_cat_comments" unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-13">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_relationship_type" columnName="name"/>
            <not>
                <indexExists indexName="cat_relationship_type_name" schemaName="cat_relationship_type"/>
            </not>
        </preConditions>
        <createIndex indexName="cat_relationship_type_name" tableName="cat_relationship_type" unique="true">
            <column name="name"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-14">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_role_type_cat_comments" columnName="comments_id"/>
            <not>
                <indexExists indexName="cat_role_type_cat_comments_id_idx" schemaName="cat_role_type_cat_comments"/>
            </not>
        </preConditions>
        <createIndex indexName="cat_role_type_cat_comments_id_idx" tableName="cat_role_type_cat_comments"
                     unique="false">
            <column name="comments_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-15">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="query_result_cell" columnName="column_id"/>
            <not>
                <indexExists indexName="query_result_cell_comments_id_idx" schemaName="query_result_cell"/>
            </not>
        </preConditions>
        <createIndex indexName="query_result_cell_comments_id_idx" tableName="query_result_cell" unique="false">
            <column name="column_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-16">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="query_result_cell" columnName="row_id"/>
            <not>
                <indexExists indexName="query_result_cell_row_id_idx" schemaName="query_result_cell"/>
            </not>
        </preConditions>
        <createIndex indexName="query_result_cell_row_id_idx" tableName="query_result_cell" unique="false">
            <column name="row_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-17">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="query_result_col" columnName="table_id"/>
            <not>
                <indexExists indexName="query_result_cell_table_id_idx" schemaName="query_result_col"/>
            </not>
        </preConditions>
        <createIndex indexName="query_result_cell_table_id_idx" tableName="query_result_col" unique="false">
            <column name="table_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-18">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="query_result_row" columnName="table_id"/>
            <not>
                <indexExists indexName="query_result_row_tabl_id_idx" schemaName="query_result_row"/>
            </not>
        </preConditions>
        <createIndex indexName="query_result_row_tabl_id_idx" tableName="query_result_row" unique="false">
            <column name="table_id"/>
        </createIndex>
    </changeSet>


    <changeSet author="kherm (generated)" id="67-19">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="query_result_table" columnName="instance_id"/>
            <not>
                <indexExists indexName="query_result_table_instance_id_idx" schemaName="query_result_table"/>
            </not>
        </preConditions>
        <createIndex indexName="query_result_table_instance_id_idx" tableName="query_result_table" unique="false">
            <column name="instance_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="kherm (generated)" id="67-20">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="query_result_table" columnName="data_id"/>
            <not>
                <indexExists indexName="query_result_table_data_id_idx" schemaName="query_result_table"/>
            </not>
        </preConditions>
        <createIndex indexName="query_result_table_data_id_idx" tableName="query_result_table" unique="false">
            <column name="data_id"/>
        </createIndex>
    </changeSet>


    <changeSet id="68" author="kherm">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="cat_entry" columnName="communityUrl"/>
        </preConditions>
        <modifyColumn tableName="cat_entry">
            <column name="communityUrl" type="text"/>
        </modifyColumn>
    </changeSet>

    <changeSet id="69" author="kherm">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="query_result_data"/>
            <not>
                <columnExists tableName="query_result_data" columnName="fileName"/>
            </not>
        </preConditions>
        <addColumn tableName="query_result_data">
            <column name="fileName" type="text"/>
        </addColumn>
    </changeSet>

</databaseChangeLog>
